---
title: 06-网络配置
toc: true
date: 2019-04-28 19:29:43
tags:
categories:
---

## 指定端口映射
- -P : Docker 会随机映射一个 49000~49900 的端口到内部容器开放的网络端口
- -p : 具体指定，可以多次使用来绑定多个端口，有如下三种格式

1. ip:hostPort:containerPort： 映射到指定地址的指定端口
1. ip::containerPort： 映射到指定地址的任意端口
1. hostPort:containerPort： 映射所有接口地址

- 指定udp端口
```
docker run -d -p 127.0.0.1:5000:5000/udp training/webapp python app.py
```

## 查看端口映射
```
docker port <container name>
```

## 配置DNS
Docker 利用虚拟文件来挂载容器的 3 个相关配置文件。在容器中使用 mount 命令可以看到挂载信息：

```
/dev/vda1 on /etc/resolv.conf type ext4 (rw,relatime,data=ordered)
/dev/vda1 on /etc/hostname type ext4 (rw,relatime,data=ordered)
/dev/vda1 on /etc/hosts type ext4 (rw,relatime,data=ordered)
```
这种机制可以让宿主主机 DNS 信息发生更新后，所有 Docker 容器的 DNS 配置通过 /etc/resolv.conf 文件立刻得到更新。

- 配置全部容器的 DNS

可以在 /etc/docker/daemon.json 文件中增加以下内容来设置。
```
{
    "dns" : [
        "114.114.114.114",
        "8.8.8.8"
    ]
}
```
这样每次启动的容器 DNS 自动配置为 114.114.114.114 和 8.8.8.8 。

- 单独配置容器

在使用 docker run 命令启动容器时加入如下参数：

1. -h HOSTNAME 或者 --hostname=HOSTNAME 设定容器的主机名，它会被写到容器内的 /etc/hostname 和 /etc/hosts 。但它在容器外部看不到，既不会在docker container ls 中显示，也不会在其他的容器的 /etc/hosts 看到。
2. --dns=IP_ADDRESS 添加 DNS 服务器到容器的 /etc/resolv.conf 中，让容器用这个服务器来解析所有不在 /etc/hosts 中的主机名。
3. --dns-search=DOMAIN 设定容器的搜索域，当设定搜索域为 .example.com时，在搜索一个名为 host 的主机时，DNS 不仅搜索 host，还会搜索host.example.com 。

> 注意：如果在容器启动时没有指定最后两个参数，Docker 会默认用主机上的
/etc/resolv.conf 来配置容器。