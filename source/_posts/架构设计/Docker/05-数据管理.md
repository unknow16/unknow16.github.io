---
title: 05-数据管理
toc: true
date: 2019-04-28 19:02:47
tags:
categories:
---

这一篇介绍如何在 Docker 内部以及容器之间管理数据，在容器中管理数据主要有
两种方式：
- 数据卷（Volumes）
- 挂载主机目录 (Bind mounts)

## 数据卷
数据卷 是一个可供一个或多个容器使用的特殊目录，它绕过 UFS，可以提供很多有用的特性：
- 数据卷 可以在容器之间共享和重用
- 对 数据卷 的修改会立马生效
- 对 数据卷 的更新，不会影响镜像
- 数据卷 默认会一直存在，即使容器被删除

> 注意： 数据卷 的使用，类似于 Linux 下对目录或文件进行 mount，镜像中的
被指定为挂载点的目录中的文件会隐藏掉，能显示看的是挂载的 数据卷 。


```
// 创建一个数据卷
docker volume create my-vol

// 查看所有的 数据卷
docker volume ls

// 查看指定 数据卷 的信息
docker volume inspect my-vol

// 查看某容器的数据卷信息,数据卷 信息在 "Mounts" Key 下面
docker inspect <container name>
```

- 启动一个挂载数据卷的容器

在用 docker run 命令的时候，使用 --mount 标记来将 数据卷 挂载到容器里。在一次 docker run中可以挂载多个 数据卷 。

下面创建一个名为 web 的容器，并加载一个 数据卷 到容器的 /webapp 目
录。

```
docker run -d -P \
--name web \
# -v my-vol:/wepapp \
--mount source=my-vol,target=/webapp \
training/webapp \
python app.py
```
- 删除数据卷

```
// 删除指定数据卷
docker volume rm my-vol

// 清除无主的数据卷
docker volume prune
```
数据卷 是被设计用来持久化数据的，它的生命周期独立于容器，Docker 不会在容器被删除后自动删除 数据卷 ，并且也不存在垃圾回收这样的机制来处理没有任何容器引用的 数据卷 。如果需要在删除容器的同时移除数据卷。可以在删除容器的时候使用 docker rm -v 这个命令。

## 挂载主机目录

```
// 使用--mount参数挂载一个主机目录作为数据卷
// 也可以挂载一个本地主机文件作为数据卷
docker run -d -P \
    --name web \
    # -v /src/webapp:/opt/webapp \
    --mount type=bind,source=/src/webapp,target=/opt/webapp \
    training/webapp \
    python app.py
```
上面的命令加载主机的 /src/webapp 目录到容器的 /opt/webapp 目录。这个功能在进行测试的时候十分方便，比如用户可以放置一些程序到本地目录中，来查看容器是否正常工作。本地目录的路径必须是绝对路径，以前使用 -v 参数时如果本地目录不存在 Docker 会自动为你创建一个文件夹，现在使用 --mount 参数时如果本地目录不存在，Docker 会报错。

Docker 挂载主机目录的默认权限是 读写 ，用户也可以通过增加 readonly 指定为 只读 。
```
docker run -d -P \
    --name web \
    # -v /src/webapp:/opt/webapp:ro \
    --mount type=bind,source=/src/webapp,target=/opt/webapp,readonly \
    training/webapp \
    python app.py
```

查看数据卷的具体信息根volume方式一样采用docker inspect <container name> 配置信息在 "Mounts" Key 下面。