---
title: 白话版认证流程
toc: true
date: 2019-07-03 16:26:32
tags:
categories:
---



## 前言

先介绍几个接口，熟悉一下

- Principal： java.security中的接口，用户凭证，其中主要getName()获取用户名
- Authentication：Spring的认证对象接口，继承Principal，包含详细认证信息，常用实现类UsernamePasswordAuthenticationToken

## 入口

1. Spring Security的核心入口是一系列的Filter组成的过滤器链
2. 经过过滤器链中的UsernamePasswordAuthenticationFilter获取到用户名和密码
3. 封装成Authentication，然后进入认证流程

## 认证流程

认证流程的核心是AuthenticationManager 接口，只有一个authenticate()方法，入参和返回值都是Authentication，但两者确差别很大

- 入参：仅包含了用户名和密码
- 返回值：包含了用户的权限列表、身份信息、详情信息等

所以authenticate()方法核心就是将上面前者转换为后者，且校验密码。

在实际需求中，我们可能会允许用户使用用户名+密码登录，同时允许用户使用邮箱+密码，手机号码+密码登录，所以AuthenticationManager一般不直接认证，它内部维护了一个List列表，存放多个AuthenticationProvider，去认证不同的登录方式。在默认策略下，只需要通过一个AuthenticationProvider的认证，即可被认为是登录成功。

按照我们最直观的思路，怎么去认证一个用户呢？用户前台提交了用户名和密码，而数据库中保存了用户名和密码，认证便是负责比对同一个用户名，提交的密码和保存的密码是否相同便是了。AuthenticationProvider最常用的一个实现便是DaoAuthenticationProvider，即校验数据库中的用户名密码。



## 参考资料

> - []()
> - []()
