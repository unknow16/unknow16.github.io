---
title: 流量管理
toc: true
date: 2019-10-15 20:07:01
tags:
categories:
---





Istio的流量路由规则使您可以轻松控制服务之间的流量和API调用。 Istio简化了诸如断路器，超时和重试之类的服务级别属性的配置，并使其易于设置重要任务（如A / B测试，canary部署和基于百分比的流量拆分的分阶段部署）。它还提供了开箱即用的故障恢复功能，有助于使您的应用程序更强大，以防止相关服务或网络的故障。

Istio的流量管理模型依靠与服务一起部署的Envoy代理。网格服务发送和接收的所有流量（数据平面流量）都通过Envoy进行代理，从而可以轻松地引导和控制网状网络周围的流量，而无需对服务进行任何更改。

## 介绍Istio流量管理

为了在网状网络内引导流量，Istio需要知道所有端点在哪里以及它们属于哪些服务。为了填充自己的服务注册表，Istio连接到服务发现系统。例如，如果您在Kubernetes群集上安装了Istio，则Istio会自动检测该群集中的服务和端点。

使用此服务注册表，Envoy代理可以将流量定向到相关服务。大多数基于微服务的应用程序每个服务工作负载都有多个实例来处理服务流量，有时也称为负载平衡池。默认情况下，Envoy代理使用循环模型在每个服务的负载平衡池中分配流量，该请求将请求依次发送到每个池成员，并在每个服务实例收到请求后返回池的顶部。

虽然Istio的基本服务发现和负载平衡为您提供了一个有效的服务网格，但远非Istio所能做的。在许多情况下，您可能希望对网状流量发生的情况进行更细粒度的控制。您可能希望将特定百分比的流量定向到服务的新版本，作为A / B测试的一部分，或者将不同的负载平衡策略应用于特定服务实例子集的流量。您可能还想将特殊规则应用于进出网格的流量，或将网格的外部依赖项添加到服务注册表。您可以使用Istio的流量管理API向Istio添加自己的流量配置，以完成所有这些工作。

与其他Istio配置一样，该API使用Kubernetes自定义资源定义（CRD）指定，您可以使用YAML对其进行配置，如示例所示。

本指南的其余部分将检查每种流量管理API资源以及如何使用它们。这些资源是：

- 虚拟服务 
- 目的地规则 
- 网关 
- 服务条目 
- 边车

本指南还概述了API资源中内置的一些网络弹性和测试功能。

## 参考资料
> - []()
> - []()
