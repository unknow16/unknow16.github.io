---
title: 常用存储引擎
date: 2018-01-19 23:55:46
tags: DB
---

MySQL体系结构分三层：客户端->服务层->存储引擎

1. MySQL是插件式的存储引擎，其中存储引擎分很多种。只要实现符合mysql存储引擎的接口，可以开发自己的存储引擎!
1. 所有跨存储引擎的功能都是在服务层实现的。
1. MySQL的存储引擎是针对表的，不是针对库的。也就是说在一个数据库中可以使用不同的存储引擎。但是不建议这样做。

## InnoDB存储引擎
MySQL5.5及之后版本默认的存储引擎：InnoDB。

#### 1. InnoDB使用表空间进行数据存储。
- MySQL5.5默认使用系统表空间
- MySQL5.6及以后默认使用独立表空间
```
show variables like 'innodb_file_per_table
```

- 值为 ON 将建立独立的表空间，文件为tablename.ibd
- 值为 OFF 将数据存储到系统的共享表空间，文件为ibdataX（X为从1开始的整数）

系统表空间无法简单的收缩文件大小，造成空间浪费，并会产生大量的磁盘碎片。独立表空间可以通过optimeze table 收缩系统文件，不需要重启服务器也不会影响对表的正常访问。

系统表空间如果对多个表进行刷新时，实际上是顺序进行的，会产生IO瓶颈。独立表空间可以同时向多个文件刷新数据。

#### 2. 事务性存储引擎
MySQL的事务支持不是依赖于MySQL服务器，而是依赖于存储引擎的，InnoDB完全支持事务的ACID特性

- Redo Log: 保存某数据块被修改后的值，用于恢复未写入data file的已提交事务更新的数据
- Undo Log: 保存某数据块被修改前的值，用于回滚事务

#### 3. 支持多版本并发控制的行级锁
行级锁可以最大程度地支持并发

#### 4. 支持崩溃后恢复

#### 5. 参数配置

```
sort_buffer_size #定义了每个线程排序缓存区的大小，MySQL在有查询、需要做排序操作时才会为每个缓冲区分配内存（直接分配该参数的全部内存）；
join_buffer_size #定义了每个线程所使用的连接缓冲区的大小，如果一个查询关联了多张表，MySQL会为每张表分配一个连接缓冲，导致一个查询产生了多个连接缓冲；
read_buffer_size #定义了当对一张MyISAM进行全表扫描时所分配读缓冲池大小，MySQL有查询需要时会为其分配内存，其必须是4k的倍数；
read_rnd_buffer_size #索引缓冲区大小，MySQL有查询需要时会为其分配内存，只会分配需要的大小。
```
以上四个参数是为一个线程分配的，如果有100个连接，那么需要×100。

## MyISAM存储引擎
MyISAM是MySQL5.5之前的默认数据库引擎，由早期的 ISAM （Indexed Sequential Access Method：有索引的顺序访问方法）所改良。虽然性能极佳，而且提供了大量的特性，包括全文索引、压缩、空间函数等，但MyISAM不支持事务和行级锁，而且最大的缺陷就是崩溃后无法安全恢复。

#### 主要区别
1. MyISAM是非事务安全型的，而InnoDB是事务安全型的。
1. MyISAM锁的粒度是表级，而InnoDB支持行级锁定。
1. MyISAM支持全文类型索引，而InnoDB不支持全文索引。

## 常用命令
1. 查看表的存储类型（三种）：

```
show create table tablename
show table status from dbname where name=tablename
mysqlshow -u user -p password --status dbname tablename
```
2. 修改表的存储引擎：

```
alter table tablename engine=InnoDB
```

3. 启动mysql数据库的命令行中添加以下参数使新发布的表都默认使用事务：

```
--default-table-engine=InnoDB
```

